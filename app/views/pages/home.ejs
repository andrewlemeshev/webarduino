<% layout('../layout') -%>
<div class="list-group menu">
  <a href="#" class="list-group-item disabled">
    cvwdmkvownnvdw
  </a>
  <a href="#" class="list-group-item">
    dwvvwvwvwvvdvwv
  </a>
</div>
<div id="panel" class="panel"></div>
<script type="text/javascript">
$( document ).ready(function() {
  function Pins(pinName, pinType, pinX, pinY, pinOut, pinIn) {
    this.pinName;
    this.pinType;
    this.pinX;
    this.pinY;
    this.pinOut;
    this.pinIn;
  }

  function ArduinoElement(name, type, pinCount, pins, statement) {
    this.name = name;
    this.type = type;
    this.pinCount = pinCount;
    this.pins = pins;
    this.statement = statement;
    this.that = this;
  }

  var responceJson;
  console.log("ready");
  $.ajax({
    url: 'http://localhost:3000/getjson',
    method: 'POST',
    data: 'done',
    dataType: 'html'
  }).done(function (msg) {
    console.log('success');
    responceJson = JSON.parse(msg);//, function(k, v) {
      //console.log("k: "+k+" v: "+v);
    //});
    console.log(responceJson);
    var arduinoElement;
    var append = '<a href="#" class="list-group-item disabled">Arduino</a>';
    var arr = Object.keys(responceJson).map(function(k, v) {  return responceJson[k] });//console.log(k);console.log(v);

    for (var i = 0; i < arr.length; i++) {
      var pins = {};// = new Pins[arr[i].pinCount];
      for (var j = 0; j < arr[i].pinCount; j++) {
        pins[j].pinX = arr[i].pinX[j]; ///////////////////wqdfqcvlewpvqrhohowvbpoiqernvpoqrnovpoqeunpvuonenqhi
        pins[j].pinY = arr[i].pinY[j];
      }
      var h=0;
      Object.keys(arr[i].pinNamesAndTypes).map(function(k, v) {pins[h].pinName = k; pins[h].pinType = v; h++;});
      arduinoElement[i] = new arduinoElement(arr[i].name, arr[i].type, arr[i].pinCount, pins, arr[i].statement);
      append = append + '<a href="#" class="list-group-item">' + arr[i].name + ' ' + arr[i].type + '</a><img src="images/' + arr[i].statement.default + '">';
    }

    $(".menu").html(append);
    //var height = window.screen.availHeight * 0.9;
    //var width = window.screen.availWidth * 0.9;
    var style = {
      width: window.screen.availWidth * 0.85,
      height: window.screen.availHeight * 0.8
    }
    $("#panel").css(style);
    myPanel = new jsgl.Panel(document.getElementById("panel"));

    for (var i = 0; i < arduinoElement.length; i++) {
      arduinoElement[i]
    }
    //var element = {

    //};

    /*var source;

    var taked = function(eventArgs) {
      source = eventArgs.getSourceElement();
      //if (eventArgs.getEventType() == jsgl.MouseEvent.MOVE)
        source.setCenterLocationXY(eventArgs.getX(), eventArgs.getY());
      label.setText("Clicked");
    }

    var moving = function(eventArgs) {
      if (source != null) source.setLocationXY(eventArgs.getX(), eventArgs.getY());
      circle.setCenterLocationXY(eventArgs.getX(), eventArgs.getY());
      label.setText("Moving: "+eventArgs.getX() + "" + eventArgs.getY());
    }

    var mouseUp = function(eventArgs) {
      source = null;
      //if (eventArgs.getEventType() == jsgl.MouseEvent.MOVE)
      //  source.setLocationXY(eventArgs.getX(), eventArgs.getY());
      label.setText("Not clicked");
    }

    var func = function(eventArgs) {
      var text;
      switch(eventArgs.getEventType()) {
        case jsgl.MouseEvent.CLICK:
          source = null;
          text = "click: ";
          break;
        case jsgl.MouseEvent.DOWN:
          source = eventArgs.getSourceElement();
          text = "down: ";
          break;
        case jsgl.MouseEvent.MOVE:
          if (source != null) {
            if (source instanceof jsgl.elements.CircleElement) source.setCenterLocationXY(eventArgs.getX(), eventArgs.getY());
            else if (source instanceof jsgl.elements.LabelElement) source.setLocationXY(eventArgs.getX(), eventArgs.getY());
          }
          text = "move: ";
          break;
        case jsgl.MouseEvent.OUT:
          source = null;
          text = "out: ";
          break;
      }
      label.setText(text+eventArgs.getX() + " " + eventArgs.getY());
    }

    circle.addMouseDownListener(func);
    circle.addMouseMoveListener(func);
    circle.addMouseOutListener(func);
    circle.addClickListener(func);
    label.addMouseDownListener(func);
    label.addMouseMoveListener(func);
    label.addMouseOutListener(func);
    label.addClickListener(func);*/
    //myPanel.addMouseDownListener(taked);
    //myPanel.addMouseMoveListener(moving);
    //myPanel.addClickListener(mouseUp);
    //circle.addClickListener(mouseUp);
    //polygon.addClickListener(mouseUp);
    //label.addClickListener(mouseUp);
    /*var handler = function(eventArgs) {
    var text;
    switch(eventArgs.getEventType()) {
      case jsgl.MouseEvent.CLICK:
        circle.setCenterLocationXY(eventArgs.getX(), eventArgs.getY());
        break;
      case jsgl.MouseEvent.DOWN:
        circle.setCenterLocationXY(eventArgs.getX(), eventArgs.getY());
        break;
    }
    label.setText(text + " (" + eventArgs.getX() + "," + eventArgs.getY() + ")");
  }*/
  });
});
</script>
